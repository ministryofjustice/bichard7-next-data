# bichard7-next-data

The data in this repository is used by Bichard to process incoming messages.

## Offence Code Data

The output offence code data is generated by combining a number of different data sources into one set of offence codes. Input data is:

- **b7-overrides**. Any offence code that is referenced in this file must have its offence category set to "B7" so that it is ignored by Bichard. NB: This exists for compatibility with the legacy dataset and should be removed in future.
- **civil-libra-codes**. Data carried over from the legacy dataset that requires analysis to determine whether it is still needed.
- **local-offences**. Data carried over from the legacy dataset that requires analysis to determine whether it is still needed. It appears that this data contains localised versions of national offences, achieved by prepending the CJS code with the force Area Code in order to generate a new CJS code.
- **unsupported-codes**. Data carried over from the legacy dataset that requires analysis to determine whether it is still needed. It appears that when the old Listpoint data source was replaced by the CJS data source, certain codes could no longer be supported by the legacy system.
- **legacy-dataset-overrides**. Data carried over from the legacy dataset that requires analysis to determine whether it is still needed.

## Consistently Formatting Data

In order to make differences between versions of data easy to read, the data should be sorted before committing. This can be done by running `./data-formatter/format.sh` from the root of the repository. This will sort the arrays of data by alphabetical attribute name and then output them with their attributes sorted.

## Publishing

### Node Package

The output-data lib is published as an NPM package to [GitHub packages](https://github.com/features/packages) using a [GitHub Actions](https://github.com/features/actions) workflow `.github/workflows/release.yml`.

Versioning and publishing is automated using [semantic-release](https://github.com/semantic-release/semantic-release). The following commit convention convention triggers releases:

| Commit message                                                                                                                                                                                   | Release type                                                                                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------- |
| `fix(pencil): stop graphite breaking when too much pressure applied`                                                                                                                             | ~~Patch~~ Fix Release                                                                                           |
| `feat(pencil): add 'graphiteWidth' option`                                                                                                                                                       | ~~Minor~~ Feature Release                                                                                       |
| `perf(pencil): remove graphiteWidth option`<br><br>`BREAKING CHANGE: The graphiteWidth option has been removed.`<br>`The default graphite width of 10mm is always used for performance reasons.` | ~~Major~~ Breaking Release <br /> (Note that the `BREAKING CHANGE: ` token must be in the footer of the commit) |

### Maven Package

The output-data lib is also published as a Maven artefact to [Sonatype](https://s01.oss.sonatype.org).

The following command reads the version from `package.json` updates the POM and deploys the artefacy

`mvn compile exec:java && mvn compile versions:set deploy -P load-properties`
