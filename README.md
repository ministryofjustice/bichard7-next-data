# bichard7-next-data

The data in this repository is used by Bichard to process incoming messages.

## Offence Code Data

The output offence code data is generated by combining a number of different data sources into one set of offence codes. Input data is:

- **b7-overrides**. Any offence code that is referenced in this file must have its offence category set to "B7" so that it is ignored by Bichard. NB: This exists for compatibility with the legacy dataset and should be removed in future.
- **civil-libra-codes**. Data carried over from the legacy dataset that requires analysis to determine whether it is still needed.
- **local-offences**. Data carried over from the legacy dataset that requires analysis to determine whether it is still needed. It appears that this data contains localised versions of national offences, achieved by prepending the CJS code with the force Area Code in order to generate a new CJS code.
- **unsupported-codes**. Data carried over from the legacy dataset that requires analysis to determine whether it is still needed. It appears that when the old Listpoint data source was replaced by the CJS data source, certain codes could no longer be supported by the legacy system.
- **legacy-dataset-overrides**. Data carried over from the legacy dataset that requires analysis to determine whether it is still needed.

## Consistently Formatting Data

In order to make differences between versions of data easy to read, the data should be sorted before committing. This can be done by running `./data-formatter/format.sh` from the root of the repository. This will sort the arrays of data by alphabetical attribute name and then output them with their attributes sorted.

## Publishing

The data contained within the `output-data` folder is automatically published as both an [NPM package](https://www.npmjs.com/package/@moj-bichard7-developers/bichard7-next-data) and a [Maven artefact](https://repo1.maven.org/maven2/io/github/ministryofjustice/bichard7/bichard7-next-data/) by the [Release GitHub Actions workflow](https://github.com/ministryofjustice/bichard7-next-data/actions/workflows/release.yml) in this repository.

Whenever commits are pushed to the `main` branch:
- The patch version number in `output-data/package.json` is incremented and committed
- The npm package is built and published
- Maven reads the version number in `output-data/package.json`, and uses that to build and publish a Maven artefact
- A PR is generated in the [bichard7-next-core]() repository to update the npm standing data dependency to the latest version
- A PR is generated in the [bichard7-next]() repository to update the gradle standing data dependency to the latest version

This means that every time new commits are added to `main`, new Maven and npm packages will automatically be published.

If breaking changes are introduced to `main`, it's advisable to manually bump the major version release number as part of those changes. This follows [Semantic Versioning](https://semver.org/) principles.
